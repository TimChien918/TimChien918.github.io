<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='Access-Control-Allow-Headers' content='Origin, X-Requested-With, Content-Type, Accept'>
    <meta http-equiv='Access-Control-Allow-Methods' content='GET,POST,PUT,DELETE,OPTIONS'>
    <meta http-equiv='Access-Control-Allow-Origin' content='*'>
    <meta http-equiv='Access-Control-Allow-Credentials' content='true'>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js'></script>
    <script src='https://fustyles.github.io/webduino/SpBlocklyJS/GameElements_20190131/marked.min.js'></script>
    <script src='https://fustyles.github.io/webduino/SpBlocklyJS/GameElements_20190131/gameelements.js'></script>
    <link rel='stylesheet' href='https://fustyles.github.io/webduino/SpBlocklyJS/css/icon_custom.css' />
    <script src='https://fustyles.github.io/webduino/SpBlocklyJS/hands_20220614/hands_video.js'></script>
    <script src='https://fustyles.github.io/webduino/SpBlocklyJS/hands_20220614/hands.js'></script>
    <script src='https://fustyles.github.io/webduino/SpBlocklyJS/SpreadsheetSQL_20210403/spreadsheetsql.js'></script>
    <script src='https://fustyles.github.io/webduino/SpBlocklyJS/SpreadsheetSQL_20210403/loader.js'></script>
    <script src='https://fustyles.github.io/webduino/SpBlocklyJS/line_20220729/line.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.2/rollups/aes.js'></script>
    <script src='https://fustyles.github.io/webduino/SpBlocklyJS/gemini_20240209/gemini.js'></script>
    <script src='https://fustyles.github.io/webduino/SpBlocklyJS/audioRecord_20250405/audioRecord.js'></script>
</head>

<body>
    <script>
        // === Web Speech API TTS（取代原本 TTS 函式庫）===
        let voices = [];
        const defaultVoices = { zh: null, en: null, ja: null, ko: null };
        const preferredGender = "female";   // 想改成男聲可改成 "male"
        let ttsEnabled = false;
        let ttsBaseRate = 1.0;
        let ttsBasePitch = 1.0;
        let ttsBaseVolume = 1.0;

        function warmupVoices() {
            if (!voices.length || !window.speechSynthesis) return;
            voices.forEach((v) => {
                const u = new SpeechSynthesisUtterance(" ");
                u.voice = v;
                u.volume = 0; // 靜音預熱
                u.rate = 1;
                u.pitch = 1;
                speechSynthesis.speak(u);
            });
        }

        function populateVoices() {
            if (!window.speechSynthesis) return;
            voices = window.speechSynthesis.getVoices();
            if (!voices.length) return;
            voices.forEach((v, i) => {
                const name = v.name || "";
                // ⛔ 排除「美佳」語音
                if (/美佳|Meijia|MeiJia|meijia/i.test(name)) {
                    return; // skip
                }
                const lang = (v.lang || "").toLowerCase();
                if (!defaultVoices.zh && (lang.startsWith("zh") || /Chinese|國語|中文/.test(name))) {
                    defaultVoices.zh = v;
                }
                if (!defaultVoices.en && (lang.startsWith("en") || /English/.test(name))) {
                    defaultVoices.en = v;
                }
                if (!defaultVoices.ja && (lang.startsWith("ja") || /Japanese|日本語/.test(name))) {
                    defaultVoices.ja = v;
                }
                if (!defaultVoices.ko && (lang.startsWith("ko") || /Korean|한국어/.test(name))) {
                    defaultVoices.ko = v;
                }
            });
            // 輕微延遲後預熱，減少之後朗讀延遲感
            setTimeout(warmupVoices, 800);
        }

        // Voice selection UI removed

        function pickVoiceFor(lang) {
            if (!voices.length) return null;
            const targetLang = (lang || "").toLowerCase();
            // 嘗試從所有 voices 中挑出語言相符的清晰系統語音（例如 Google 語音）
            let langVoices = voices.filter((v) =>
                (v.lang || "").toLowerCase().startsWith(targetLang)
            );
            if (!langVoices.length) {
                langVoices = voices; // 找不到就退回全部 voices
            }
            // 優先挑選名稱中含 Google 的語音（多數瀏覽器此類聲音較自然清晰）
            let pool = langVoices;
            const googlePool = langVoices.filter(v => /google/i.test(v.name || ""));
            if (googlePool.length) {
                pool = googlePool;
            }
            const femaleRe = /female|woman|girl|女|女性|小姐|女士/i;
            const maleRe = /male|man|boy|男|男性|先生/i;
            let candidate = null;
            if (preferredGender === "female") {
                candidate = pool.find((v) => femaleRe.test(v.name || ""));
            } else if (preferredGender === "male") {
                candidate = pool.find((v) => maleRe.test(v.name || ""));
            }
            if (candidate) return candidate;
            if (defaultVoices[lang]) return defaultVoices[lang];
            return pool[0] || voices[0];
        }

        // 偵測一段文字的主要語言（中文 / 英文 / 日文 / 韓文）
        function detectLang(str) {
            let zh = 0, en = 0, ja = 0, ko = 0;
            for (const ch of str) {
                if (/[\u4e00-\u9fff]/.test(ch)) zh++;
                else if (/[ぁ-ゔァ-ヴー々〆〤]/.test(ch)) ja++;
                else if (/[가-힣]/.test(ch)) ko++;
                else if (/[a-zA-Z]/.test(ch)) en++;
            }
            const total = zh + en + ja + ko;
            if (total === 0) return "en";

            const scores = [
                { lang: "zh", score: zh },
                { lang: "en", score: en },
                { lang: "ja", score: ja },
                { lang: "ko", score: ko },
            ];
            scores.sort((a, b) => b.score - a.score);
            return scores[0].lang;
        }

        // 供原本程式呼叫的介面：設定語速/音調/音量（langTag 可忽略）
        function ttsSetProperty(rate, pitch, volume, langTag) {
            ttsBaseRate = rate || 1.0;
            ttsBasePitch = pitch || 1.0;
            ttsBaseVolume = volume || 1.0;
        }

        // 開關語音朗讀（原本 volume_off 按鈕用）
        function ttsSwitch(onOff) {
            if (!("speechSynthesis" in window)) return;
            if (onOff) {
                ttsEnabled = true;
            } else {
                ttsEnabled = false;
                speechSynthesis.cancel();
            }
        }

        function ttsState(action) {
            if (!("speechSynthesis" in window)) return;
            if (action === "cancel") {
                speechSynthesis.cancel();
            }
        }

        // 實際執行朗讀：正式支援中英混合句自動切換、<br>視為換行、句子級斷句+句內再細切中/英片段、避免單獨朗讀標點、統一聲線
        async function ttsSpeak(voiceName, text) {
            if (!ttsEnabled) return;
            if (!text || !("speechSynthesis" in window)) return;

            // 將 AI 回答中的 <br> 等標籤一律視為換行，避免有內容沒被唸到
            const raw = String(text).replace(/<br\s*\/?>/gi, "\n");

            // 依句號級標點切句，避免吃掉後半句
            const sentences = raw
                .replace(/([。．！？!?]|\?|！)/g, "$1\n")
                .split(/\n+/)
                .map((s) => s.trim())
                .filter((s) => s.length > 0);

            // 開始朗讀前，確保沒有殘留語音
            speechSynthesis.cancel();

            for (let i = 0; i < sentences.length; i++) {
                const segment = sentences[i];
                if (!segment) continue;

                // 判斷是否中英混合
                let zhCount = 0;
                let enCount = 0;
                for (const ch of segment) {
                    if (/[\u4e00-\u9fff]/.test(ch)) zhCount++;
                    else if (/[a-zA-Z]/.test(ch)) enCount++;
                }
                const isMixed = zhCount > 0 && enCount > 0;

                if (!isMixed) {
                    const voice = pickVoiceFor(lang) || voices[0];
                    const utter = new SpeechSynthesisUtterance(segment);
                    utter.voice = voice;
                    if (lang === "en") {
                        utter.rate = ttsBaseRate * 0.75;   // 英文再慢一些，發音更清楚
                    } else if (lang === "zh") {
                        utter.rate = ttsBaseRate * 0.88;   // 中文略慢但仍自然
                    } else {
                        utter.rate = ttsBaseRate * 0.9;
                    }
                    utter.pitch = ttsBasePitch;
                    utter.volume = ttsBaseVolume;
                    if (voice && voice.lang) {
                        utter.lang = voice.lang;
                    }

                    await new Promise((resolve) => {
                        utter.onend = resolve;
                        speechSynthesis.speak(utter);
                    });
                    await delay(0.06);
                } else {
                    // 中英混合：切成語言片段，逐段朗讀（同你之前專用 TTS 的設計）
                    const rawParts =
                        segment.match(/[\u4e00-\u9fff]+|[a-zA-Z0-9]+|[^ \u4e00-\u9fff a-zA-Z0-9]+/g) ||
                        [segment];

                    const punctRegex = /^[\s。．！？!?，,.;:、…（）()「」『』“”"'\-]+$/;
                    const chunks = [];
                    let bufferText = "";
                    let bufferLang = null;

                    for (const part of rawParts) {
                        const isPunct = punctRegex.test(part);
                        const lang = detectLang(part);

                        if (isPunct) {
                            // 標點附加到前一個片段，避免單獨朗讀「逗號」、「句號」
                            if (bufferText) {
                                bufferText += part;
                            }
                            continue;
                        }

                        if (!bufferText) {
                            bufferText = part;
                            bufferLang = lang;
                            continue;
                        }

                        if (lang === bufferLang) {
                            bufferText += part;
                        } else {
                            chunks.push({ text: bufferText, lang: bufferLang });
                            bufferText = part;
                            bufferLang = lang;
                        }
                    }

                    if (bufferText) {
                        chunks.push({ text: bufferText, lang: bufferLang });
                    }

                    for (const chunk of chunks) {
                        const voice = pickVoiceFor(chunk.lang) || voices[0];
                        const utter = new SpeechSynthesisUtterance(chunk.text);
                        utter.voice = voice;
                        if (chunk.lang === "en") {
                            utter.rate = ttsBaseRate * 0.75;
                        } else if (chunk.lang === "zh") {
                            utter.rate = ttsBaseRate * 0.88;
                        } else {
                            utter.rate = ttsBaseRate * 0.9;
                        }
                        utter.pitch = ttsBasePitch;
                        utter.volume = ttsBaseVolume;
                        if (voice && voice.lang) {
                            utter.lang = voice.lang;
                        }

                        await new Promise((resolve) => {
                            utter.onend = resolve;
                            speechSynthesis.speak(utter);
                        });
                        await delay(0.06);
                    }
                }
            }
        }

        const delay = (seconds) => {
            return new Promise((resolve) => {
                setTimeout(resolve, seconds * 1000);
            });
        };
        const main = async () => {
            var _E5_8E_9F_E5_A7_8B_E5_AF_86_E7_A2_BC1, palm_size, Back_of_hand_size, _E5_8E_9F_E5_A7_8B_E5_AF_86_E7_A2_BC2, question, Trial_calculation_table_URL, _E5_8A_A0_E5_AF_86_E5_AF_86_E7_A2_BC1, Voice_Prompt, _E5_8A_A0_E5_AF_86_E5_AF_86_E7_A2_BC2, answer, Traditional_Chinese_Medicine_Website, i, palm, Voice_reading_status, width, Voice_recognition_status, Acupoint_Database, Traditional_Chinese_Medicine_Prompt, Translation_Prompt;

            // 描述此函式...
            function _E8_AE_8A_E6_95_B8() {
                _E5_8E_9F_E5_A7_8B_E5_AF_86_E7_A2_BC1 = 'AIzaSyBqAiiDHMKXHr8j';
                _E5_8E_9F_E5_A7_8B_E5_AF_86_E7_A2_BC2 = 'AHLmCWN85CTat3tZTP0';
                _E5_8A_A0_E5_AF_86_E5_AF_86_E7_A2_BC1 = (CryptoJS.AES.encrypt(_E5_8E_9F_E5_A7_8B_E5_AF_86_E7_A2_BC1, 'LLM1').toString());
                _E5_8A_A0_E5_AF_86_E5_AF_86_E7_A2_BC2 = (CryptoJS.AES.encrypt(_E5_8E_9F_E5_A7_8B_E5_AF_86_E7_A2_BC2, 'LLM2').toString());
                answer = '回答';
                question = '問題';
                Trial_calculation_table_URL = 'https://docs.google.com/spreadsheets/d/12DBfaxVzqMqpCxfaMV47QzgJupS7SZ9YtYLWGExvUh4/edit?usp=sharing';
                Traditional_Chinese_Medicine_Website = 'https://cloudtcm.com/shu/list/414/0';
                palm = '';
                width = 500;
                palm_size = 0;
                Acupoint_Database = ['陽池穴', '少澤穴', '落枕穴', '合谷穴', '少衝穴', '商陽穴', '陽谿穴', '中渚穴', '內關穴', '魚際穴', '太淵穴', '中衝穴', '列缺穴', '前谷穴', '神門穴', '三間穴', '二間穴', '后溪穴', '勞宮穴', '井穴'];
                Traditional_Chinese_Medicine_Prompt = ['您是一位具備診斷和治療能力的專業中醫醫師。請勿使用您已有的中醫知識。請事先準備好網站（雲端中醫 https://cloudtcm.com/shu/list/414/0）上的內容。患者將逐步描述其症狀。請基於針灸和艾灸的新方法、針灸科學原理以及您的專業診斷，為患者制定量身定制的針灸治療方案。請確保您的回覆包含穴位訊息，並提供兩個與症狀相對應的手掌穴位以緩解疼痛。請將此資訊控制在30字以內。準備好後請告知。', Acupoint_Database].join('');
                Translation_Prompt = 'Please answer in the language I ues to ask you.';
                Voice_reading_status = false;
                Voice_recognition_status = false;
                Voice_Prompt = ['You are a professional voice transcriptionist who will transcribe everything I say into text and you will follow the following rules:', '1. Transcribe the audio into text.\\n', '2. Do not use markdown syntax in reply.', '3.Please consider Chinese or English first when listening', '4.What I\'m asking for, please don\'t output anything else.'].join('');
            }

            // 描述此函式...
            async function Send_a_conversation() {
                div_set('', "innerHTML", ([fontText(3, '#cc0000', 'Arial', (textarea_get('', "value"))), '<br>', '<br>', div_get('', "innerHTML")].join('')));
                question = (textarea_get('', "value"));
                await gemini_chat_run((textarea_get('', "value")));
                textarea_set('', "value", '');
            }

            // 描述此函式...
            async function Identify() {
                async function textarea__keydown(event) {
                    if (event.keyCode == 13) {
                        Send_a_conversation();
                        await delay(0.1);
                        textarea_set('', "value", '');
                    }
                };
                document.getElementById('gametextarea_' + '').addEventListener("keydown", textarea__keydown, true);
                async function textarea__focus(event) {
                    element_select("gametextarea_");
                };
                document.getElementById('gametextarea_' + '').addEventListener("focus", textarea__focus, true);
                async function gemini_chat_response(gemini_chat_data) {
                    answer = (gemini_chat_response_br(gemini_chat_data, ''));
                    div_set('', "innerHTML", ([fontText(3, '#33cc00', 'Arial', (gemini_chat_response_br(gemini_chat_data, ''))), '<br>', '<br>', div_get('', "innerHTML")].join('')));
                    await ttsSpeak(("Eddy (英文（美國）)"), (gemini_chat_response_br(gemini_chat_data, '')));
                    spreadsheet_insert("insertlast", String("gmt_datetime") + "|" + String(question) + "|" + String(answer[0]) + "|" + String(answer[1]) + "|" + String(answer[2]), 0, 0, "", Trial_calculation_table_URL, '病症', "https://script.google.com/macros/s/AKfycbxA3hhTlntwVTOcqngOC_iJL_zLmRwzcDbMYDs7FD8iinNsY9XZsMkD7AcXTIUbEc33EA/exec");
                    i = setDatetime(0, 0, 0, 0, 0, 0);
                    linebot_push_message('jHELtzp2oiHQK5sdSciRYvNi2FIwZiCbVhjRoxvhuzXVZCHGx6PtY6BqGJS6OyYL7AE42vqyzPikesqbLb+mE2kj06X5YofYiSAM9YAA0+1Phs2pSKrlhtDVOTc479rvHLz6lW9MPdPLIxyAk31bTQdB04t89/1O/w1cDnyilFU=', 'U119e52abd339210576e354879f5ce368', line_url_escape("bot", "text", ([getDatetime(i, "datetime"), '<br>', 'Question:' + String(question), '<br>', '<br>', answer[0], '<br>', '<br>', answer[1], '<br>', '<br>', answer[2]].join('')), '', '', ''));
                    select_set('手掌', "value", '無');
                    // 使用使用者提供的 Apps Script 進行中英翻譯
                    // 這裡直接使用「整段 AI 回答文字」，讓 Apps Script 幫忙做完整翻譯（不要過濾掉中文字，避免只剩標點）
                    const fullTextForTranslate = (Array.isArray(answer) ? answer.join(' ') : String(answer || '')).trim();

                    const englishTranslateUrl = "https://script.google.com/macros/s/AKfycbxu-hcx6XL7WavrtJ3OW5__CJZ15vF8At-FSPhWiSkIznV3N5RUau1-OBDv-NMdnIXGcQ/exec";
                    const chineseTranslateUrl = "https://script.google.com/macros/s/AKfycbxtQM0RyiiScQdvh3nWI_FLiIqBWpWxSrW7PDhVkN8tSJk6CPwcdPuWUkAkh4AgjZcX/exec";

                    // 翻譯成繁體中文並顯示在 div 'c'
                    try {
                        const zhRes = await fetch(chineseTranslateUrl + "?text=" + encodeURIComponent(fullTextForTranslate));
                        const zhRaw = await zhRes.text();
                        let zhText = zhRaw;

                        // 如果 Apps Script 回傳的是 JSON，例如 {"original":"头","translated":"頭"}
                        try {
                            const zhJson = JSON.parse(zhRaw);
                            if (zhJson && typeof zhJson === 'object' && zhJson.translated) {
                                zhText = zhJson.translated;
                            }
                        } catch (e) {
                            // 不是 JSON 就維持原本文字
                        }

                        div_set('c', "innerHTML", (
                            [fontText(3, '#33cc00', 'Arial', zhText),
                                '<br>', '<br>', div_get('c', "innerHTML")].join('')
                        ));
                    } catch (err) {
                        console.log("Chinese translation error:", err);
                    }

                    // 翻譯成英文並顯示在 div 'e'
                    try {
                        const enRes = await fetch(englishTranslateUrl + "?text=" + encodeURIComponent(fullTextForTranslate));
                        const enRaw = await enRes.text();
                        let enText = enRaw;

                        // 如果 Apps Script 回傳的是 JSON，例如 {"original":"头","translated":"head","targetLang":"en"}
                        try {
                            const enJson = JSON.parse(enRaw);
                            if (enJson && typeof enJson === 'object' && enJson.translated) {
                                enText = enJson.translated;
                            }
                        } catch (e) {
                            // 不是 JSON 就維持原本文字
                        }

                        div_set('e', "innerHTML", (
                            [fontText(3, '#33cc00', 'Arial', enText),
                                '<br>', '<br>', div_get('e', "innerHTML")].join('')
                        ));
                    } catch (err) {
                        console.log("English translation error:", err);
                    }

                    palm = answer[1];

                }
                window.gemini_chat_response = gemini_chat_response;
                async function gamebutton_replay_onclick(event) {
                    gemini_chat_clear();
                    div_set('', "innerHTML", '');
                    textarea_set('', "value", '');
                };
                document.getElementById("gamebutton_replay").addEventListener("click", gamebutton_replay_onclick, true);
                async function gamebutton_save_onclick(event) {
                    gemini_chat_content_file("save");
                };
                document.getElementById("gamebutton_save").addEventListener("click", gamebutton_save_onclick, true);
                async function gamebutton_upload_file_onclick(event) {
                    div_set('', "innerHTML", '');
                    gemini_chat_content_file("open");
                };
                document.getElementById("gamebutton_upload_file").addEventListener("click", gamebutton_upload_file_onclick, true);
                async function gamebutton_volume_off_onclick(event) {
                    if (Voice_reading_status) {
                        ttsSwitch(0);
                        button_set('volume_off', "value", 'Turn on the speaker');
                        button_set('volume_off', "color", '#000000');
                        ttsState("cancel");
                    } else {
                        ttsSwitch(1);
                        button_set('volume_off', "color", '#ff0000');
                        button_set('volume_off', "value", 'Turn off the speaker');
                    }
                    Voice_reading_status = !Voice_reading_status;
                };
                document.getElementById("gamebutton_volume_off").addEventListener("click", gamebutton_volume_off_onclick, true);
                async function gamebutton_mic_off_onclick(event) {
                    if (Voice_recognition_status) {
                        button_set('mic_off', "value", 'Click me to record');
                        button_set('mic_off', "color", '#000000');
                        await recording_stopRecordingGeminiSTT();
                        await delay(1);
                    } else {
                        button_set('mic_off', "value", 'Recording...');
                        button_set('mic_off', "color", '#ff0000');
                        await recording_startRecording();
                    }
                    Voice_recognition_status = !Voice_recognition_status;
                };
                document.getElementById("gamebutton_mic_off").addEventListener("click", gamebutton_mic_off_onclick, true);
                async function gamebutton_wechat_onclick(event) {
                    Send_a_conversation();
                };
                document.getElementById("gamebutton_wechat").addEventListener("click", gamebutton_wechat_onclick, true);
            }

            // 描述此函式...
            function Yuji() {
                palm_size = (hands_distance((hands_position(0, "3", "x")), (hands_position(0, "3", "y")), (hands_position(0, "2", "x")), (hands_position(0, "2", "y")))) * 0.3;
                image_set('手掌', "height", palm_size);
                image_set('手掌', "width", palm_size);
                image_set('手掌', "left", (400 + ((((hands_position(0, "2", "x")) + (hands_position(0, "1", "x"))) / 2 - palm_size / 2) - palm_size / 2)));
                image_set('手掌', "top", (((hands_position(0, "2", "y")) + (hands_position(0, "1", "y"))) / 2 - palm_size / 2));
                span_set('手掌', "fontsize", palm_size);
                span_set('手掌', "display", true);
                span_set('手掌', "innerHTML", ('魚際' + '穴'));
                span_set('手掌', "left", (image_get('手掌', "left")));
                span_set('手掌', "top", ((image_get('手掌', "top")) - (palm_size + palm_size / 2)));
            }

            // 描述此函式...
            function Nei_Guan() {
                palm_size = Math.abs((hands_angle((hands_position(0, "0", "x")), (hands_position(0, "0", "y")), (hands_position(0, "9", "x")), (hands_position(0, "9", "y")))) / 1.5 - ((hands_angle((hands_position(0, "0", "x")), (hands_position(0, "0", "y")), (hands_position(0, "9", "x")), (hands_position(0, "9", "y")))) - (hands_angle((hands_position(0, "0", "x")), (hands_position(0, "0", "y")), (hands_position(0, "9", "x")), (hands_position(0, "9", "y")))) / 1.5)) / 2;
                palm_size = palm_size * 0.9;
                image_set('手掌', "height", palm_size);
                image_set('手掌', "left", (400 + (((hands_position(0, "0", "x")) * 2 - (hands_position(0, "9", "x")) * 1) / (2 - 1) - palm_size / 2)));
                image_set('手掌', "top", (((hands_position(0, "0", "y")) * 2 - (hands_position(0, "9", "y")) * 1) / (2 - 1) - palm_size / 2));
                span_set('手掌', "fontsize", palm_size);
                span_set('手掌', "display", true);
                span_set('手掌', "innerHTML", ('內關' + '穴'));
                span_set('手掌', "left", (image_get('手掌', "left")));
                span_set('手掌', "top", ((image_get('手掌', "top")) - (palm_size + palm_size / 2)));
                image_set('手掌', "width", palm_size);
            }

            // 描述此函式...
            function Tai_Yuan() {
                palm_size = (hands_distance((hands_position(0, "1", "x")), (hands_position(0, "1", "y")), (hands_position(0, "0", "x")), (hands_position(0, "0", "y")))) / 2;
                palm_size = palm_size * 0.6;
                image_set('手掌', "height", palm_size);
                image_set('手掌', "width", palm_size);
                image_set('手掌', "left", (400 + (((hands_position(0, "1", "x")) + (hands_position(0, "0", "x"))) / 2 - palm_size / 2)));
                image_set('手掌', "top", ((hands_position(0, "0", "y")) - palm_size / 2));
                span_set('手掌', "fontsize", palm_size);
                span_set('手掌', "display", true);
                span_set('手掌', "innerHTML", ('太淵' + '穴'));
                span_set('手掌', "left", (image_get('手掌', "left")));
                span_set('手掌', "top", ((image_get('手掌', "top")) - (palm_size + palm_size / 2)));
            }

            // 描述此函式...
            function Zhongchong() {
                palm_size = Math.abs(hands_distance((hands_position(0, "12", "x")), (hands_position(0, "12", "y")), (hands_position(0, "11", "x")), (hands_position(0, "11", "y"))));
                palm_size = palm_size * 0.5;
                image_set('手掌', "height", palm_size);
                image_set('手掌', "width", palm_size);
                image_set('手掌', "left", (400 + ((hands_position(0, "12", "x")) - palm_size / 2)));
                image_set('手掌', "top", ((hands_position(0, "12", "y")) - palm_size));
                span_set('手掌', "fontsize", palm_size);
                span_set('手掌', "display", true);
                span_set('手掌', "innerHTML", ('中衝' + '穴'));
                span_set('手掌', "left", (image_get('手掌', "left")));
                span_set('手掌', "top", ((image_get('手掌', "top")) + palm_size + palm_size / 2));
            }

            // 描述此函式...
            function Qiang_Gu() {
                image_set('手掌', "url", 'https://timchien918.github.io/acupointhalf.png');
                palm_size = (hands_distance((hands_position(0, "6", "x")), (hands_position(0, "6", "y")), (hands_position(0, "7", "x")), (hands_position(0, "7", "y"))));
                palm_size = palm_size * 0.7;
                image_set('手掌', "height", (palm_size * 0.5));
                image_set('手掌', "width", palm_size);
                image_set('手掌', "left", (400 + ((hands_position(0, "17", "x")) - palm_size * 0.7)));
                image_set('手掌', "top", ((hands_position(0, "17", "y")) - palm_size * 0.25));
                image_set('手掌', "rotateZ", (hands_angle((hands_position(0, "0", "x")), (hands_position(0, "0", "y")), (hands_position(0, "17", "x")), (hands_position(0, "17", "y")))));
                span_set('手掌', "fontsize", palm_size);
                span_set('手掌', "display", true);
                span_set('手掌', "innerHTML", ('前谷' + '穴'));
                span_set('手掌', "left", (image_get('手掌', "left")));
                span_set('手掌', "top", ((image_get('手掌', "top")) - (palm_size + palm_size / 2)));
            }

            // 描述此函式...
            function Shenmen() {
                palm_size = (hands_distance((hands_position(0, "5", "x")), (hands_position(0, "5", "y")), (hands_position(0, "9", "x")), (hands_position(0, "9", "y")))) * 0.5;
                image_set('手掌', "height", palm_size);
                image_set('手掌', "width", palm_size);
                image_set('手掌', "left", (400 + (((hands_position(0, "9", "x")) - ((hands_position(0, "5", "x")) - (hands_position(0, "0", "x"))) * 1) - palm_size / 2)));
                image_set('手掌', "top", (((hands_position(0, "9", "y")) - ((hands_position(0, "5", "y")) - (hands_position(0, "0", "y"))) * 1) - palm_size / 2));
                span_set('手掌', "fontsize", palm_size);
                span_set('手掌', "display", true);
                span_set('手掌', "innerHTML", ('神門' + '穴'));
                span_set('手掌', "left", (image_get('手掌', "left")));
                span_set('手掌', "top", ((image_get('手掌', "top")) - (palm_size + palm_size / 2)));
            }

            // 描述此函式...
            function Third_Point() {
                image_set('手掌', "url", 'https://timchien918.github.io/acupointhalf.png');
                palm_size = (hands_distance((hands_position(0, "5", "x")), (hands_position(0, "5", "y")), (hands_position(0, "9", "x")), (hands_position(0, "9", "y")))) / 2;
                image_set('手掌', "rotateZ", (180 + (hands_angle((hands_position(0, "5", "x")), (hands_position(0, "5", "y")), (hands_position(0, "6", "x")), (hands_position(0, "6", "y"))))));
                image_set('手掌', "height", (palm_size * 0.7));
                image_set('手掌', "width", palm_size);
                image_set('手掌', "left", (400 + (((hands_position(0, "5", "x")) + (hands_position(0, "6", "x"))) / 2 - palm_size * 0.2)));
                image_set('手掌', "top", (((hands_position(0, "5", "y")) + (hands_position(0, "6", "y"))) / 2 - palm_size / 2));
                span_set('手掌', "fontsize", palm_size);
                span_set('手掌', "display", true);
                span_set('手掌', "innerHTML", ('三間' + '穴'));
                span_set('手掌', "left", (image_get('手掌', "left")));
                span_set('手掌', "top", ((image_get('手掌', "top")) - (palm_size + palm_size / 2)));
            }

            // 描述此函式...
            function _E4_BA_95_E7_A9_B4() {
                image_set('手掌', "url", 'https://timchien918.github.io/acupointhalf.png');
                palm_size = (hands_distance((hands_position(0, "5", "x")), (hands_position(0, "5", "y")), (hands_position(0, "9", "x")), (hands_position(0, "9", "y")))) / 2;
                image_set('手掌', "rotateZ", (180 + (hands_angle((hands_position(0, "5", "x")), (hands_position(0, "5", "y")), (hands_position(0, "6", "x")), (hands_position(0, "6", "y"))))));
                image_set('手掌', "height", (palm_size * 0.7));
                image_set('手掌', "width", palm_size);
                image_set('手掌', "left", (400 + ((hands_position(0, "8", "x")) - palm_size * 0.2)));
                image_set('手掌', "top", ((hands_position(0, "8", "y")) - palm_size / 2));
                span_set('手掌', "fontsize", palm_size);
                span_set('手掌', "display", true);
                span_set('手掌', "innerHTML", '井穴');
                span_set('手掌', "left", (image_get('手掌', "left")));
                span_set('手掌', "top", ((image_get('手掌', "top")) - (palm_size + palm_size / 2)));
            }

            // 描述此函式...
            function Hou_Xi() {
                image_set('手掌', "url", 'https://timchien918.github.io/acupointhalf.png');
                palm_size = (hands_angle((hands_position(0, "0", "x")), (hands_position(0, "0", "y")), (hands_position(0, "17", "x")), (hands_position(0, "17", "y")))) / 4;
                image_set('手掌', "rotateZ", (hands_angle((hands_position(0, "0", "x")), (hands_position(0, "0", "y")), (hands_position(0, "17", "x")), (hands_position(0, "17", "y")))));
                image_set('手掌', "height", (palm_size / 2));
                image_set('手掌', "width", palm_size);
                image_set('手掌', "left", (400 + (((hands_position(0, "0", "x")) + (hands_position(0, "17", "x")) * 4) / 5 - palm_size * 1.2)));
                image_set('手掌', "top", (((hands_position(0, "0", "y")) + (hands_position(0, "17", "y")) * 4) / 5 - palm_size * 0.25));
                span_set('手掌', "fontsize", palm_size);
                span_set('手掌', "display", true);
                span_set('手掌', "innerHTML", ('后溪' + '穴'));
                span_set('手掌', "left", (image_get('手掌', "left")));
                span_set('手掌', "top", ((image_get('手掌', "top")) - (palm_size + palm_size / 2)));
            }

            // 描述此函式...
            function Second_Point() {
                image_set('手掌', "url", 'https://timchien918.github.io/acupointhalf.png');
                palm_size = (hands_distance((hands_position(0, "5", "x")), (hands_position(0, "5", "y")), (hands_position(0, "9", "x")), (hands_position(0, "9", "y")))) / 2;
                image_set('手掌', "rotateZ", (180 + (hands_angle((hands_position(0, "5", "x")), (hands_position(0, "5", "y")), (hands_position(0, "6", "x")), (hands_position(0, "6", "y"))))));
                image_set('手掌', "height", palm_size);
                image_set('手掌', "width", (palm_size * 1.5));
                image_set('手掌', "left", (400 + ((hands_position(0, "5", "x")) - palm_size * 0.2)));
                image_set('手掌', "top", ((hands_position(0, "5", "y")) - palm_size / 2));
                span_set('手掌', "fontsize", palm_size);
                span_set('手掌', "display", true);
                span_set('手掌', "innerHTML", ('二間' + '穴'));
                span_set('手掌', "left", (image_get('手掌', "left")));
                span_set('手掌', "top", ((image_get('手掌', "top")) - (palm_size + palm_size / 2)));
            }

            // 描述此函式...
            function _E5_8B_9E_E5_AE_AE() {
                palm_size = Math.abs((hands_distance((hands_position(0, "0", "x")), (hands_position(0, "0", "y")), (hands_position(0, "9", "x")), (hands_position(0, "9", "y")))) / 1.6 - ((hands_distance((hands_position(0, "0", "x")), (hands_position(0, "0", "y")), (hands_position(0, "9", "x")), (hands_position(0, "9", "y")))) - (hands_distance((hands_position(0, "0", "x")), (hands_position(0, "0", "y")), (hands_position(0, "9", "x")), (hands_position(0, "9", "y")))) / 1.6)) * 0.5;
                image_set('手掌', "height", palm_size);
                image_set('手掌', "width", palm_size);
                image_set('手掌', "left", (400 + ((hands_position(0, "9", "x")) - palm_size / 2)));
                image_set('手掌', "top", ((hands_position(0, "5", "y")) + ((hands_distance((hands_position(0, "0", "x")), (hands_position(0, "0", "y")), (hands_position(0, "9", "x")), (hands_position(0, "9", "y")))) / 1.6 - palm_size / 2) / 2));
                span_set('手掌', "fontsize", palm_size);
                span_set('手掌', "display", true);
                span_set('手掌', "innerHTML", ('勞宮' + '穴'));
                span_set('手掌', "left", (image_get('手掌', "left")));
                span_set('手掌', "top", ((image_get('手掌', "top")) - (palm_size + palm_size / 2)));
            }

            // 描述此函式...
            function Yangxi_acupoint() {
                Back_of_hand_size = (hands_distance((hands_position(0, "2", "x")), (hands_position(0, "2", "y")), (hands_position(0, "1", "x")), (hands_position(0, "1", "y")))) / 2;
                Back_of_hand_size = Back_of_hand_size / 2;
                image_set('手背', "url", 'https://timchien918.github.io/acupointhalf.png');
                image_set('手背', "height", Back_of_hand_size);
                image_set('手背', "width", (Back_of_hand_size * 1.5));
                image_set('手背', "rotateZ", (0 + (hands_angle((hands_position(0, "0", "x")), (hands_position(0, "0", "y")), (hands_position(0, "1", "x")), (hands_position(0, "1", "y"))))));
                image_set('手背', "left", (400 + (((hands_position(0, "0", "x")) + (hands_position(0, "1", "x"))) / 2 - Back_of_hand_size)));
                image_set('手背', "top", (((hands_position(0, "0", "y")) + (hands_position(0, "1", "y"))) / 2 - Back_of_hand_size / 2));
                span_set('手背', "fontsize", Back_of_hand_size);
                span_set('手背', "display", true);
                span_set('手背', "innerHTML", ('陽谿' + '穴'));
                span_set('手背', "left", (image_get('手背', "left")));
                span_set('手背', "top", ((image_get('手背', "top")) - (Back_of_hand_size + Back_of_hand_size / 2)));
            }

            // 描述此函式...
            function _E8_90_BD_E6_9E_95() {
                Back_of_hand_size = Math.abs((hands_angle((hands_position(0, "0", "x")), (hands_position(0, "0", "y")), (hands_position(0, "5", "x")), (hands_position(0, "5", "y")))) / 1.6 - ((hands_angle((hands_position(0, "0", "x")), (hands_position(0, "0", "y")), (hands_position(0, "5", "x")), (hands_position(0, "5", "y")))) - (hands_angle((hands_position(0, "0", "x")), (hands_position(0, "0", "y")), (hands_position(0, "5", "x")), (hands_position(0, "5", "y")))) / 1.6)) * 0.5;
                image_set('手背', "height", Back_of_hand_size);
                image_set('手背', "width", Back_of_hand_size);
                image_set('手背', "left", (400 + (((hands_position(0, "9", "x")) + (hands_position(0, "5", "x"))) / 2 - palm_size / 2)));
                image_set('手背', "top", ((hands_position(0, "9", "y")) + ((hands_angle((hands_position(0, "0", "x")), (hands_position(0, "0", "y")), (hands_position(0, "5", "x")), (hands_position(0, "5", "y")))) / 1.6 - Back_of_hand_size / 2) / 2));
                span_set('手背', "fontsize", Back_of_hand_size);
                span_set('手背', "display", true);
                span_set('手背', "innerHTML", ('落枕' + '穴'));
                span_set('手背', "left", (image_get('手背', "left")));
                span_set('手背', "top", ((image_get('手背', "top")) - (Back_of_hand_size + Back_of_hand_size / 2)));
            }

            // 描述此函式...
            function _E5_95_86_E9_99_BD() {
                Back_of_hand_size = (hands_distance((hands_position(0, "8", "x")), (hands_position(0, "8", "y")), (hands_position(0, "7", "x")), (hands_position(0, "7", "y")))) * 0.5;
                image_set('手背', "url", 'https://timchien918.github.io/acupointhalf.png');
                image_set('手背', "rotateZ", (180 + (hands_angle((hands_position(0, "8", "x")), (hands_position(0, "8", "y")), (hands_position(0, "7", "x")), (hands_position(0, "7", "y"))))));
                image_set('手背', "height", Back_of_hand_size);
                image_set('手背', "width", (Back_of_hand_size * 1.5));
                image_set('手背', "left", (400 + ((hands_position(0, "8", "x")) - Back_of_hand_size / 1.2)));
                image_set('手背', "top", ((hands_position(0, "8", "y")) - Back_of_hand_size / 2));
                span_set('手背', "fontsize", Back_of_hand_size);
                span_set('手背', "display", true);
                span_set('手背', "innerHTML", ('商陽' + '穴'));
                span_set('手背', "left", (image_get('手背', "left")));
                span_set('手背', "top", ((image_get('手背', "top")) - (Back_of_hand_size + Back_of_hand_size / 2)));
            }

            // 描述此函式...
            function _E5_88_97_E7_BC_BA() {
                palm_size = (hands_distance((hands_position(0, "5", "x")), (hands_position(0, "5", "y")), (hands_position(0, "9", "x")), (hands_position(0, "9", "y")))) / 2;
                image_set('手掌', "url", 'https://timchien918.github.io/acupointhalf.png');
                image_set('手掌', "height", palm_size);
                image_set('手掌', "left", ((400 + ((hands_position(0, "0", "x")) + (hands_position(0, "1", "x"))) * 0.5) - palm_size / 2));
                image_set('手掌', "top", (((hands_position(0, "0", "y")) + (hands_angle((hands_position(0, "0", "x")), (hands_position(0, "0", "y")), (hands_position(0, "9", "x")), (hands_position(0, "9", "y")))) / 3) - palm_size / 2));
                image_set('手掌', "rotateZ", (180 + (hands_angle((hands_position(0, "0", "x")), (hands_position(0, "0", "y")), (hands_position(0, "9", "x")), (hands_position(0, "9", "y"))))));
                image_set('手掌', "width", (palm_size * 1.5));
                span_set('手掌', "fontsize", palm_size);
                span_set('手掌', "display", true);
                span_set('手掌', "innerHTML", ('列缺' + '穴'));
                span_set('手掌', "left", (image_get('手掌', "left")));
                span_set('手掌', "top", ((image_get('手掌', "top")) - (palm_size + palm_size / 2)));
            }

            // 描述此函式...
            function _E5_90_88_E8_B0_B7() {
                Back_of_hand_size = Math.abs((hands_distance((hands_position(0, "0", "x")), (hands_position(0, "0", "y")), (hands_position(0, "9", "x")), (hands_position(0, "9", "y")))) / 1.6 - ((hands_distance((hands_position(0, "0", "x")), (hands_position(0, "0", "y")), (hands_position(0, "9", "x")), (hands_position(0, "9", "y")))) - (hands_distance((hands_position(0, "0", "x")), (hands_position(0, "0", "y")), (hands_position(0, "9", "x")), (hands_position(0, "9", "y")))) / 1.6)) * 0.5;
                image_set('手背', "height", Back_of_hand_size);
                image_set('手背', "width", Back_of_hand_size);
                image_set('手背', "left", (400 + ((hands_position(0, "5", "x")) - palm_size / 2)));
                image_set('手背', "top", ((hands_position(0, "5", "y")) + ((hands_distance((hands_position(0, "0", "x")), (hands_position(0, "0", "y")), (hands_position(0, "9", "x")), (hands_position(0, "9", "y")))) / 1.6 - Back_of_hand_size / 2) / 2));
                span_set('手背', "fontsize", Back_of_hand_size);
                span_set('手背', "display", true);
                span_set('手背', "innerHTML", ('合谷' + '穴'));
                span_set('手背', "left", (image_get('手背', "left")));
                span_set('手背', "top", ((image_get('手背', "top")) - (Back_of_hand_size + Back_of_hand_size / 2)));
            }

            // 描述此函式...
            function _E9_99_BD_E6_B1_A0() {
                Back_of_hand_size = (hands_distance((hands_position(0, "5", "x")), (hands_position(0, "5", "y")), (hands_position(0, "9", "x")), (hands_position(0, "9", "y")))) / 2;
                image_set('手背', "height", Back_of_hand_size);
                image_set('手背', "width", Back_of_hand_size);
                image_set('手背', "left", (400 + ((hands_position(0, "0", "x")) - Back_of_hand_size / 2)));
                image_set('手背', "top", ((hands_position(0, "0", "y")) - Back_of_hand_size / 2));
                span_set('手背', "fontsize", Back_of_hand_size);
                span_set('手背', "display", true);
                span_set('手背', "innerHTML", ('陽池' + '穴'));
                span_set('手背', "left", (image_get('手背', "left")));
                span_set('手背', "top", ((image_get('手背', "top")) - (Back_of_hand_size + Back_of_hand_size / 2)));
            }

            // 描述此函式...
            function _E4_B8_AD_E6_B8_9A() {
                Back_of_hand_size = (hands_distance((hands_position(0, "17", "x")), (hands_position(0, "17", "y")), (hands_position(0, "13", "x")), (hands_position(0, "13", "y")))) * 0.5;
                image_set('手背', "height", Back_of_hand_size);
                image_set('手背', "width", Back_of_hand_size);
                image_set('手背', "left", (400 + (((hands_position(0, "17", "x")) + (hands_position(0, "13", "x"))) / 2 - Back_of_hand_size / 2)));
                image_set('手背', "top", ((hands_position(0, "17", "y")) - Back_of_hand_size / 2));
                span_set('手背', "fontsize", Back_of_hand_size);
                span_set('手背', "display", true);
                span_set('手背', "innerHTML", ('中渚' + '穴'));
                span_set('手背', "left", (image_get('手背', "left")));
                span_set('手背', "top", ((image_get('手背', "top")) - (Back_of_hand_size + Back_of_hand_size / 2)));
            }

            // 描述此函式...
            function _E5_B0_91_E8_A1_9D() {
                Back_of_hand_size = (hands_distance((hands_position(0, "19", "x")), (hands_position(0, "19", "y")), (hands_position(0, "18", "x")), (hands_position(0, "18", "y")))) * 0.5;
                image_set('手背', "height", Back_of_hand_size);
                image_set('手背', "left", (400 + ((hands_position(0, "19", "x")) - Back_of_hand_size / 2)));
                image_set('手背', "top", ((hands_position(0, "19", "y")) - Back_of_hand_size / 2));
                image_set('手背', "url", 'https://timchien918.github.io/acupointhalf.png');
                image_set('手背', "rotateZ", (180 + (hands_angle((hands_position(0, "20", "x")), (hands_position(0, "20", "y")), (hands_position(0, "18", "x")), (hands_position(0, "18", "y"))))));
                image_set('手背', "width", (Back_of_hand_size * 1.5));
                span_set('手背', "fontsize", Back_of_hand_size);
                span_set('手背', "display", true);
                span_set('手背', "innerHTML", ('少衝' + '穴'));
                span_set('手背', "left", (image_get('手背', "left")));
                span_set('手背', "top", ((image_get('手背', "top")) - (Back_of_hand_size + Back_of_hand_size / 2)));
            }

            // 描述此函式...
            function _E5_B0_91_E6_BE_A4() {
                image_set('手背', "url", 'https://timchien918.github.io/acupointhalf.png');
                Back_of_hand_size = (hands_distance((hands_position(0, "19", "x")), (hands_position(0, "19", "y")), (hands_position(0, "18", "x")), (hands_position(0, "18", "y")))) * 0.5;
                image_set('手背', "rotateZ", (0 + (hands_angle((hands_position(0, "20", "x")), (hands_position(0, "20", "y")), (hands_position(0, "18", "x")), (hands_position(0, "18", "y"))))));
                image_set('手背', "left", (400 + ((hands_position(0, "20", "x")) - Back_of_hand_size / 2)));
                image_set('手背', "top", ((hands_position(0, "20", "y")) - Back_of_hand_size / 2));
                image_set('手背', "width", (Back_of_hand_size * 1.5));
                image_set('手背', "height", Back_of_hand_size);
                span_set('手背', "fontsize", Back_of_hand_size);
                span_set('手背', "display", true);
                span_set('手背', "innerHTML", ('少澤' + '穴'));
                span_set('手背', "left", (image_get('手背', "left")));
                span_set('手背', "top", ((image_get('手背', "top")) - (Back_of_hand_size + Back_of_hand_size / 2)));
            }


            _E8_AE_8A_E6_95_B8();
            spreadsheet_insert("insertlast", String('time') + "|" + String('question') + "|" + String('original') + "|" + String('Translate into Traditional Chinese') + "|" + String('Translate into English'), 0, 0, "", Trial_calculation_table_URL, '病症', "https://script.google.com/macros/s/AKfycbxA3hhTlntwVTOcqngOC_iJL_zLmRwzcDbMYDs7FD8iinNsY9XZsMkD7AcXTIUbEc33EA/exec");
            recording_GeminiSTT_initial(0, (String(CryptoJS.AES.decrypt(_E5_8A_A0_E5_AF_86_E5_AF_86_E7_A2_BC1, 'LLM1').toString(CryptoJS.enc.Utf8)) + String(CryptoJS.AES.decrypt(_E5_8A_A0_E5_AF_86_E5_AF_86_E7_A2_BC2, 'LLM2').toString(CryptoJS.enc.Utf8))), "gemini-2.5-flash", Voice_Prompt);
            audioGeminiSTT = async function (geminiResult) {
                textarea_set('', "value", (geminiResult));

            };
            head_add_viewport(1, 1, 2, "no");
            include_file("css", "", 'https://fustyles.github.io/webduino/GameElements_20190131/test_scroll.css');
            button_create('replay', 132, 35, 0, 0, 1, null, 'Reset Conversation', 12, 999, true);
            button_create('save', 132, 35, 0, 35, 1, null, 'Save Conversation', 12, 999, true);
            button_create('upload_file', 132, 35, 132, 0, 1, null, 'Loading Conversation', 12, 999, true);
            button_create('volume_off', 132, 35, 132, 35, 1, null, 'Turn on the speaker', 12, 999, true);
            button_create('mic_off', 132, 35, 264, 0, 1, null, 'Click me to record', 12, 999, true);
            button_create('wechat', 132, 35, 264, 35, 1, null, 'Send conversation', 12, 999, true);
            textarea_create('', 0, 75, 47, 3, '請輸入對話', 1, 999, true);
            // 預設開啟語音朗讀
            ttsSetProperty(1, 1, 1, "en-GB");
            ttsSwitch(1);
            Voice_reading_status = true;
            // 將喇叭按鈕外觀同步為「已開啟」狀態
            button_set('volume_off', "color", '#ff0000');
            button_set('volume_off', "value", 'Turn off the speaker');
            // Voice selection UI removed
            div_create('', 395, 400, 0, 140, "solid", 1, '#000000', '#ffffff', '#000000', 20, 1, '', 999, true);
            div_create('c', 195, 400, 0, 550, "solid", 1, '#000000', '#ffffff', '#000000', 10, 1, '', 999, true);
            div_create('e', 195, 400, 200, 550, "solid", 1, '#000000', '#ffffff', '#000000', 10, 1, '', 999, true);
            div_set('', "class", 'container');
            gemini_chat_initial((String(CryptoJS.AES.decrypt(_E5_8A_A0_E5_AF_86_E5_AF_86_E7_A2_BC1, 'LLM1').toString(CryptoJS.enc.Utf8)) + String(CryptoJS.AES.decrypt(_E5_8A_A0_E5_AF_86_E5_AF_86_E7_A2_BC2, 'LLM2').toString(CryptoJS.enc.Utf8))), "gemini-2.0-flash", 1000, 1.0, ([Traditional_Chinese_Medicine_Prompt, 'And you will translate your answer as follows', Translation_Prompt, 'Please don\'t just translate what I said; you still need to answer my questions.', 'Your answer must include the following acupoints.', Acupoint_Database, 'And remember, you are a super TCM doctor who will answer any question.'].join('')));
            await delay(2);
            Identify();
            select_create('手背', 300, 50, 885, 560, '#ffffff', '#000000', 20, 1, [
                ['陽池', '陽池穴'],
                ['少澤', '少澤穴'],
                ['落枕', '落枕穴'],
                ['合谷', '合谷穴'],
                ['少衝', '少衝穴'],
                ['商陽', '商陽穴'],
                ['陽谿', '陽谿穴'],
                ['中渚', '中渚穴'],
                ['無', '無']
            ], '', 999, true);
            select_create('手掌', 300, 50, 450, 530, '#ffffff', '#000000', 20, 1, [
                ['魚際', '魚際穴'],
                ['內關', '內關穴'],
                ['太淵', '太淵穴'],
                ['中衝', '中衝穴'],
                ['列缺', '列缺穴'],
                ['前谷', '前谷穴'],
                ['神門', '神門穴'],
                ['三間', '三間穴'],
                ['二間', '二間穴'],
                ['后溪', '后溪穴'],
                ['勞宮', '勞宮穴'],
                ['井', '井穴'],
                ['無', '無']
            ], '', 999, true);
            span_create('手掌標示', 500, 450, 25, (['Please select a', '<br>', 'palm acupoint'].join('')), 999);
            span_create('手背標示', 900, 450, 25, (['Please select the ', '<br>', 'acupuncture point on', '<br>', 'the back of your hand'].join('')), 999);
            span_create('手掌', 500, 600, 50, '', 1000);
            span_create('手背', 500, 600, 50, '', 1000);
            span_set('手掌', "display", false);
            span_set('手背', "display", false);
            hands_video("block", "1", "1", "1");
            hands_startvideo_media(width, 400, "front", 0);
            hands_video_position(400, 0);
            image_create('手掌', 'https://timchien918.github.io/acupoint.png', 10, 10, 0, 0, 20000, false);
            image_create('手背', 'https://timchien918.github.io/acupoint.png', 10, 10, 0, 0, 20000, false);
            image_create('手掌圖示', 'https://i.postimg.cc/zGGD8dk8/page-0001.png', width, 400, 400, 0, 999, true);
            hands_recognitionFinish = async function () {
                hands_state(0);
                image_set('手掌', "url", 'https://timchien918.github.io/acupoint.png');
                image_set('手背', "url", 'https://timchien918.github.io/acupoint.png');
                async function gameselect_手背_onchange(event) {
                    palm = '';
                };
                document.getElementById("gameselect_手背").addEventListener("change", gameselect_手背_onchange, true);
                async function gameselect_手掌_onchange(event) {
                    palm = '';
                };
                document.getElementById("gameselect_手掌").addEventListener("change", gameselect_手掌_onchange, true);
                if ((width + 400) - (hands_position(0, "1", "x")) <= (width + 400) - (hands_position(0, "17", "x"))) {
                    image_set('手掌圖示', "url", 'https://i.postimg.cc/zGGD8dk8/page-0001.png');
                    if ((select_get('手掌', "selectedValue")) == '無' && !palm.length) {
                        image_set('手掌', "display", false);
                        span_set('手掌', "display", false);
                    } else if ((select_get('手掌', "selectedValue")) == '魚際' || (palm.toLowerCase().indexOf('魚際'.toLowerCase()) != -1)) {
                        image_set('手掌', "display", true);
                        Yuji();
                    } else if ((select_get('手掌', "selectedValue")) == '井' || (palm.toLowerCase().indexOf('井穴'.toLowerCase()) != -1)) {
                        image_set('手掌', "display", true);
                        _E4_BA_95_E7_A9_B4();
                    } else if ((select_get('手掌', "selectedValue")) == '內關' || (palm.toLowerCase().indexOf('內關'.toLowerCase()) != -1)) {
                        image_set('手掌', "display", true);
                        Nei_Guan();
                    } else if ((select_get('手掌', "selectedValue")) == '太淵' || (palm.toLowerCase().indexOf('太淵'.toLowerCase()) != -1)) {
                        image_set('手掌', "display", true);
                        Tai_Yuan();
                    } else if ((select_get('手掌', "selectedValue")) == '中衝' || (palm.toLowerCase().indexOf('中衝'.toLowerCase()) != -1)) {
                        image_set('手掌', "display", true);
                        Zhongchong();
                    } else if ((select_get('手掌', "selectedValue")) == '列缺' || (palm.toLowerCase().indexOf('列缺'.toLowerCase()) != -1)) {
                        image_set('手掌', "display", true);
                        _E5_88_97_E7_BC_BA();
                    } else if ((select_get('手掌', "selectedValue")) == '前谷' || (palm.toLowerCase().indexOf('前谷'.toLowerCase()) != -1)) {
                        image_set('手掌', "display", true);
                        Qiang_Gu();
                    } else if ((select_get('手掌', "selectedValue")) == '神門' || (palm.toLowerCase().indexOf('神門'.toLowerCase()) != -1)) {
                        image_set('手掌', "display", true);
                        Shenmen();
                    } else if ((select_get('手掌', "selectedValue")) == '三間' || (palm.toLowerCase().indexOf('三間'.toLowerCase()) != -1)) {
                        image_set('手掌', "display", true);
                        Third_Point();
                    } else if ((select_get('手掌', "selectedValue")) == '勞宮' || (palm.toLowerCase().indexOf('勞宮'.toLowerCase()) != -1)) {
                        image_set('手掌', "display", true);
                        _E5_8B_9E_E5_AE_AE();
                    } else if ((select_get('手掌', "selectedValue")) == '后溪' || (palm.toLowerCase().indexOf('后溪'.toLowerCase()) != -1)) {
                        image_set('手掌', "display", true);
                        Hou_Xi();
                    } else if ((select_get('手掌', "selectedValue")) == '二間' || (palm.toLowerCase().indexOf('二間'.toLowerCase()) != -1)) {
                        image_set('手掌', "display", true);
                        Second_Point();
                    } else {
                        image_set('手掌', "display", false);
                        span_set('手掌', "display", false);
                    }
                } else {
                    image_set('手掌', "display", false);
                    span_set('手掌', "display", false);
                }
                if ((width + 400) - (hands_position(0, "1", "x")) >= (width + 400) - (hands_position(0, "17", "x"))) {
                    image_set('手掌圖示', "url", 'https://i.postimg.cc/V6SCgMtj/20240325154306761-page-0001.png');
                    if ((select_get('手背', "selectedValue")) == '無' && !palm.length) {
                        image_set('手背', "display", false);
                        span_set('手背', "display", false);
                    } else if ((select_get('手背', "selectedValue")) == '落枕' || (palm.toLowerCase().indexOf('落枕'.toLowerCase()) != -1)) {
                        image_set('手背', "display", true);
                        _E8_90_BD_E6_9E_95();
                    } else if ((select_get('手背', "selectedValue")) == '合谷' || (palm.toLowerCase().indexOf('合谷'.toLowerCase()) != -1)) {
                        image_set('手背', "display", true);
                        _E5_90_88_E8_B0_B7();
                    } else if ((select_get('手背', "selectedValue")) == '少衝' || (palm.toLowerCase().indexOf('少衝'.toLowerCase()) != -1)) {
                        image_set('手背', "display", true);
                        _E5_B0_91_E8_A1_9D();
                    } else if ((select_get('手背', "selectedValue")) == '商陽' || (palm.toLowerCase().indexOf('商陽'.toLowerCase()) != -1)) {
                        image_set('手背', "display", true);
                        _E5_95_86_E9_99_BD();
                    } else if ((select_get('手背', "selectedValue")) == '中渚' || (palm.toLowerCase().indexOf('中渚'.toLowerCase()) != -1)) {
                        image_set('手背', "display", true);
                        _E4_B8_AD_E6_B8_9A();
                    } else if ((select_get('手背', "selectedValue")) == '陽池' || (palm.toLowerCase().indexOf('陽池'.toLowerCase()) != -1)) {
                        image_set('手背', "display", true);
                        _E9_99_BD_E6_B1_A0();
                    } else if ((select_get('手背', "selectedValue")) == '少澤' || (palm.toLowerCase().indexOf('少澤'.toLowerCase()) != -1)) {
                        image_set('手背', "display", true);
                        _E5_B0_91_E6_BE_A4();
                    } else if ((select_get('手背', "selectedValue")) == '陽谿' || (palm.toLowerCase().indexOf('陽谿'.toLowerCase()) != -1)) {
                        image_set('手背', "display", true);
                        Yangxi_acupoint();
                    } else {
                        image_set('手背', "display", false);
                        span_set('手背', "display", false);
                    }
                } else {
                    image_set('手背', "display", false);
                    span_set('手背', "display", false);
                }

                hands_state(1);
            };
            hands_unrecognitionFinish = async function () {
                hands_state(0);
                image_set('', "top", (image_get('', "top") - 10));
                image_set('手背', "display", false);
                image_set('手掌', "display", false);
                span_set('手背', "display", false);
                span_set('手掌', "display", false);

                hands_state(1);
            };
        };
        main();
    </script>
</body>

</html>